<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>KitaplarÄ±m</title>
    <style>
    body
    {
        margin:0;
        height:100vh;
        display:flex;
        font-family:Segoe UI, sans-serif;
        background:#f3f4f6;
    }

    .sidebar
    {
        width:220px;
        background:#1f2933;
        color:white;
        padding:20px;
    }
    
    .sidebar h2
    {
        text-align:center;
        margin-bottom:30px;
    }
    
    .sidebar button
    {
        width:100%;
        padding:12px;
        margin:8px 0;
        background:none;
        border:none;
        color:white;
        text-align:left;
        cursor:pointer;
    }
    
    .sidebar button:hover
    {
        background:#374151;
    }
    
    .logout
    {
        background:#b91c1c !important;
    }

    .content
    {
        flex:1;
        padding:25px;
        display:flex;
        flex-direction:column;
    }

    .page-title
    {
        font-size:32px;
        margin-bottom:15px;
        text-align:center;
    }

    #kitapPanel
    {
        flex:1;
        background:white;
        padding:20px;
        border-radius:16px;
        box-shadow:0 6px 18px rgba(0,0,0,.15);
        overflow:auto;
    }

    table
    {
        width:100%;
        border-collapse:collapse;
    }
    
    th,td
    {
        padding:12px 15px;
        border-bottom:1px solid #e5e7eb;
        text-align:left;
    }

    th
    {
        background:#2563eb;
        color:white;
    }

    tr:nth-child(even)
    {
        background:#f9fafb;
    }

    .bottom-controls
    {
        margin-top:20px;
        background:white;
        padding:18px 22px;
        border-radius:16px;
        box-shadow:0 4px 12px rgba(0,0,0,.15);
        display:flex;
        justify-content:flex-end;
    }

    #iadeBtn
    {
        padding:12px 26px;
        font-size:16px;
        border:none;
        border-radius:12px;
        background:#16a34a;
        color:white;
        cursor:pointer;
    }

    #iadeBtn:hover
    {
        background:#15803d;
    }

    .message
    {
        font-size:18px;
        padding:15px;
        background:#fff3cd;
        color:#856404;
        border-radius:10px;
    }
    </style>
</head>
<body>
    <div class="sidebar">
        <h2>Ãœye Paneli</h2>
        <button onclick="window.location.href='{{url_for('user.kitaplarSayfasi')}}'">ğŸ“š Kitaplar</button>
        <button onclick="window.location.href='{{url_for('user.kitaplarim')}}'">ğŸ“– KitaplarÄ±m</button>
        <button>âš ï¸ Ceza Bilgi</button>
        <button class="logout" onclick="window.location.href='{{url_for('user.logout')}}'">ğŸšª Ã‡Ä±kÄ±ÅŸ</button>
    </div>

    <div class="content">

        <div class="page-title">KitaplarÄ±m</div>

        <div id="kitapPanel">
            <p>Veriler yÃ¼kleniyor...</p>
        </div>

        <div class="bottom-controls">
            <button id="iadeBtn" onclick="iadeEt()">SeÃ§ilenleri Ä°ade Et</button>
        </div>

    </div>
    <script>
    let secilenler = [];

    function kitaplarimiYukle() 
    {
        fetch("/kitaplarim-veri")
        .then(res => res.json())
        .then(data => {

            let panel = document.getElementById("kitapPanel");

            if (!data || data.length == 0) 
            {
                panel.innerHTML = `<div class="message">ğŸ“˜ Åu anda Ã¶dÃ¼nÃ§ alÄ±nmÄ±ÅŸ kitabÄ±nÄ±z bulunmuyor.</div>`;
                return;
            }

            let html = `
                <table>
                    <thead>
                        <tr>
                            <th>SeÃ§</th>
                            <th>Kitap AdÄ±</th>
                            <th>Yazar</th>
                            <th>AlÄ±nma</th>
                            <th>Ä°ade</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            data.forEach(book => {
                html += `
                    <tr>
                        <td>
                            <input type="checkbox" value="${book.loanID}" onchange="secimDegisti(this)">
                        </td>
                        <td>${book.bookName ?? ""}</td>
                        <td>${book.author ?? ""}</td>
                        <td>${book.loanDate ?? ""}</td>
                        <td>${book.returnDate ?? ""}</td>
                    </tr>
                `;
            });

            html += "</tbody></table>";
            panel.innerHTML = html;
        });
    }

    function secimDegisti(chk) 
    {
        let id = chk.value;
        if (chk.checked) 
        {
            secilenler.push(id);
        } 
        else 
        {
            secilenler = secilenler.filter(x => x != id);
        }
    }

    function iadeEt() 
    {
        if (secilenler.length == 0) 
        {
            alert("LÃ¼tfen kitap seÃ§iniz!");
            return;
        }

        fetch("/iade-et", {
            method:"POST",
            headers:{ "Content-Type":"application/json" },
            body:JSON.stringify({ loanIDs: secilenler })
        })
        .then(res => res.json())
        .then(data => {
            alert(data.message);
            window.location.reload();
        });
    }
    window.onload = kitaplarimiYukle;
    </script>
</body>
</html>
